<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>yuki</title>
  <link rel="stylesheet" type="text/css" href="./l.css">
</head>
<body>
  <div id="app">
    <div class="wrap df fc">
      <div class="container f1">
        <header class="df tc">
          <nav class="links-nav df">
            <a
              :class="['link-nav', 'df', 'tc', 'ac', 'link', @activedIndex == ~index ? 'actived ' + @activedColor : '']"
              ~for="link in links"
              @click="redirect(~index)">
              {{ ~link }}
            </a>
          </nav>
        </header>
        <div :class="['main', @activedBackgroundColor]" ~if="isFrontInfo">
          <div class="user-info">
            <div class="avatar df tc">
              <div class="avatar-content link" @click="switchUserinfo"></div>
            </div>
            <div class="user-info-content-name tc">Lies</div>
            <div class="user-info-content-area tc">web开发，全栈，略知一二</div>
          </div>
          <div class="user-info-back">
            <div class="tc user-info-back-content">
              <span @click="switchUserinfo" class="link">info</span>
            </div>
          </div>
        </div>
        <div :class="['main', @activedBackgroundColor]" ~if="!@isFrontInfo">
          <div class="user-desc df tc">
            <div class="user-desc-content">
              <p>九四年，生于浙江，现居广州</p>
              <p>喜欢折腾，追求极简主义，喜欢做一些有趣的项目</p>
              <p>联系我，<a>邮箱</a></p>
            </div>
          </div>
          <div class="user-info-back">
            <div class="tc user-info-back-content">
              <span @click="switchUserlogo" class="link">back</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="./render.js"></script>
  <script>
    (function () {
      var Router = function () {
        var app = document.querySelector('#app');
        this.state = [app];
        this.cache = {};
        var _this = this;
        window.onpopstate = function (e) {
          var pageIndex = 0;
          if (e.state) {
            pageIndex = e.state.pageIndex;
          }
          var app = document.querySelector('#app');
          var cacheApp = _this.state[pageIndex];
          app.parentNode.replaceChild(cacheApp, app);
        }
      };
      Router.prototype.push = function (req) {
        var _this = this;
        var pageIndex = this.state.length;
        history.pushState({ pageIndex: pageIndex }, 'title', req.path);
        if (this.cache[req.path] || this.cache[req.path] === 0) {
          var app = document.querySelector('#app');
          var cacheApp = this.state[this.cache[req.path]];
          app.parentNode.replaceChild(cacheApp, app);
          this.state.push(cacheApp);
          return false;
        }
        fetch(req.path)
        .then(function (res) {
          return res.text();
        })
        .then(function (res) {
          var container = document.createElement('div');
          container.innerHTML = res.match(/<body(.|\t|\n)*?>((.|\t|\n)*?)<\/body>/)[2].trim();
          var app = container.querySelector('#app');
          var processor = container.querySelector('[processor]').innerHTML.trim();
          var oldApp = document.querySelector('#app');
          oldApp.parentNode.replaceChild(app, oldApp);
          eval(processor);
          _this.state.push(app);
          _this.cache[req.path] = pageIndex;
        })
      };
      self.Router = Router;
      self.router = new Router();
    })();
  </script>
  <script processor>
    (function () {
      var obj = new Lies({
        data () {
          return {
            title: '测试',
            isFrontInfo: true,
            path: ['', '/yuki-frame/project', '', '', ''],
            links: ['Lies', '项目', '写真', '笔记', '友链'],
            activedIndex: 0,
            activedColor: 'crForgive',
            activedBackgroundColor: 'bcrForgive'
          }
        },
        methods: {
          switchUserinfo: function () {
            this.updater({ 'isFrontInfo': false });
          },
          switchUserlogo: function () {
            this.updater({ 'isFrontInfo': true });
          },
          redirect: function (index) {
            if (this.path[index]) {
              router.push({ path: this.path[index] });
            }
          }
        }
      });
      var el = document.getElementById('app');
      var refsObj = new Refs(el, obj);
      var refs = refsObj.templateElCache;
    })();
  </script>
</body>
</html>